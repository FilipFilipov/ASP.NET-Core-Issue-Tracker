@using IssueTracker.Services.Models.Issue
@model IssueTracker.Services.Models.Issue.IssueViewModel

@{
    ViewBag.Title = "Edit Issue";
    ViewBag.IsNew = true;
}

<h2>Edit Issue</h2>
<div class="row">
    <div class="col-md-6">
        <section>
            @Html.Partial("_IssueForm", Model)
        </section>
    </div>
    <div class="col-md-6">
        <section>            
            @Html.EditorFor(m => m.NewComment)
            <br />
            @if (Model.CanDeleteComments)
            {
                <form id="comment-delete-form" asp-action="RemoveComment" method="post">
                    <input type="hidden" id="CommentId" name="CommentId" />
                </form>
            }
            <h4>@Html.DisplayNameFor(m => m.Comments)</h4>
            @Html.DisplayFor(m => m.Comments, new { Model.CanDeleteComments })
        </section>
    </div>
</div>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")

    <script>
        $('.comment-delete').click(function () {
            var id = $(this).data('id');
            $('#CommentId').val(id);
            if (window.confirm("Are you sure you want to delete this comment?"))
            {                       
                $('#comment-delete-form').submit();
            }           
        });
    </script>
}